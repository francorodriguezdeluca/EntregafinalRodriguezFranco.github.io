!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ImpelAna=t():e.ImpelAna=t()}(self,(function(){return(()=>{var e,t,r={5802:()=>{},7629:(e,t,r)=>{"use strict";var n;r.d(t,{Z:()=>l});var i=new Uint8Array(16);function o(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(i)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&s.test(e)};for(var c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));const l=function(e,t,r){var n=(e=e||{}).random||(e.rng||o)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(r))throw TypeError("Stringified UUID is invalid");return r}(n)}}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var o=n[e]={exports:{}};return r[e].call(o.exports,o,o.exports,i),o.exports}i.m=r,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,r)=>(i.f[r](e,t),t)),[])),i.u=e=>e+".ana.min.js",i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="ImpelAna:",i.l=(r,n,o,s)=>{if(e[r])e[r].push(n);else{var a,c;if(void 0!==o)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var h=u[l];if(h.getAttribute("src")==r||h.getAttribute("data-webpack")==t+o){a=h;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",t+o),a.src=r),e[r]=[n];var d=(t,n)=>{a.onerror=a.onload=null,clearTimeout(f);var i=e[r];if(delete e[r],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(n))),t)return t(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),c&&document.head.appendChild(a)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="https://cdn.impel.io/releases/analytics/ImpelAna@0.0.2/",(()=>{var e={179:0};i.f.j=(t,r)=>{var n=i.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var o=new Promise(((r,i)=>n=e[t]=[r,i]));r.push(n[2]=o);var s=i.p+i.u(t),a=new Error;i.l(s,(r=>{if(i.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var o=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,n[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var n,o,[s,a,c]=r,u=0;if(s.some((t=>0!==e[t]))){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);c&&c(i)}for(t&&t(r);u<s.length;u++)o=s[u],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0},r=self.webpackChunkImpelAna=self.webpackChunkImpelAna||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var o={};return(()=>{"use strict";i.r(o),i.d(o,{configure:()=>L,emit:()=>q,meta:()=>D});const e=window.location.href,t=document.referrer||null,r=window.top===window.self,n=window.navigator.userAgent,s=window.location.hostname.replace(/^(www\.)+/,"");function a(e){var t=new Error(e);return t.source="ulid",t}var c="0123456789ABCDEFGHJKMNPQRSTVWXYZ",u=c.length,l=Math.pow(2,48)-1;function h(e){var t=Math.floor(e()*u);return t===u&&(t=u-1),c.charAt(t)}var d,f=(d||(d=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments[1];t||(t="undefined"!=typeof window?window:null);var r=t&&(t.crypto||t.msCrypto);if(r)return function(){var e=new Uint8Array(1);return r.getRandomValues(e),e[0]/255};try{var n=i(5802);return function(){return n.randomBytes(1).readUInt8()/255}}catch(e){}if(e){try{console.error("secure crypto unusable, falling back to insecure Math.random()!")}catch(e){}return function(){return Math.random()}}throw a("secure crypto unusable, insecure Math.random not allowed")}()),function(e){return isNaN(e)&&(e=Date.now()),function(e,t){if(isNaN(e))throw new Error(e+" must be a number");if(e>l)throw a("cannot encode time greater than "+l);if(e<0)throw a("time must be positive");if(!1===Number.isInteger(e))throw a("time must be an integer");for(var r=void 0,n="";t>0;t--)n=c.charAt(r=e%u)+n,e=(e-r)/u;return n}(e,10)+function(e,t){for(var r="";e>0;e--)r=h(t)+r;return r}(16,d)});function p(e){let t=f().toLowerCase();if(null===e||e.length<8)throw new TypeError("Invalid prefix: ${prefix}");return`${e.slice(0,8)}::${t}`}var m=i(7629);const y="SP::SESSIONSTORE",w=Object.freeze({NONE:Symbol("store_in_memory"),LS:Symbol("local_storage"),CK:Symbol("cookie")}),v=new class{constructor(){this.storeType=w.LS;try{localStorage.setItem("sts_test","TEST"),localStorage.removeItem("sts_test")}catch(e){this.storeType=w.CK}}fetchStore(){if(this._store=this._store||null,null===this._store){if(this.storeType===w.LS)this._store=localStorage.getItem(y);else if(this.storeType===w.CK);else if(this.storeType===w.NONE)return void(this._store={});try{this._store=JSON.parse(this._store)}catch(e){this._store={},this.setStore()}}null===this._store&&(this._store={},this.setStore())}setStore(){this.storeType===w.LS?localStorage.setItem(y,JSON.stringify(this._store)):(this.storeType,w.CK)}read(e){return this.fetchStore(),void 0===this._store[e]&&(this._store[e]=null),this._store[e]}write(e,t){return this.fetchStore(),this._store[e]=t,this.setStore(),this._store[e]}};let g=function(e=!1){let t=null;return e||(t=v.read("clid")),null===t&&(t=(0,m.Z)(),v.write("clid",t)),t}(),_=p(g);const b=class{constructor(e,t,r){this.evid=p(g),this.clid=g,this.prid=_,this.ts=(new Date).toISOString(),this.type=e,this.cat=t,this.data=r}static get type(){return{PAGEVIEW:"page",METADATA:"meta",ENGAGEMENT:"engg"}}},E=(new Error("timeout while waiting for mutex to become available"),new Error("mutex already locked"),new Error("request for lock canceled"));var S=function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))};class C{constructor(e,t=E){if(this._maxConcurrency=e,this._cancelError=t,this._queue=[],this._waiters=[],e<=0)throw new Error("semaphore must be initialized to a positive value");this._value=e}acquire(){const e=this.isLocked(),t=new Promise(((e,t)=>this._queue.push({resolve:e,reject:t})));return e||this._dispatch(),t}runExclusive(e){return S(this,void 0,void 0,(function*(){const[t,r]=yield this.acquire();try{return yield e(t)}finally{r()}}))}waitForUnlock(){return S(this,void 0,void 0,(function*(){return this.isLocked()?new Promise((e=>this._waiters.push({resolve:e}))):Promise.resolve()}))}isLocked(){return this._value<=0}release(){if(this._maxConcurrency>1)throw new Error("this method is unavailable on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){const e=this._currentReleaser;this._currentReleaser=void 0,e()}}cancel(){this._queue.forEach((e=>e.reject(this._cancelError))),this._queue=[]}_dispatch(){const e=this._queue.shift();if(!e)return;let t=!1;this._currentReleaser=()=>{t||(t=!0,this._value++,this._resolveWaiters(),this._dispatch())},e.resolve([this._value--,this._currentReleaser])}_resolveWaiters(){this._waiters.forEach((e=>e.resolve())),this._waiters=[]}}const x=["AccessDeniedException","ExpiredTokenException","ServiceUnavailableException","UnrecognizedClientException"];class I{constructor(e,t){this.region=e,this.idPool=t}async fetch(){let e=JSON.parse(v.read("fhcred"));return null!==(t=e)&&new Date(t.expiration)-new Date>6e5?e:await this.refresh();var t}async refresh(){const{CognitoIdentityClient:e,GetIdCommand:t,GetCredentialsForIdentityCommand:r}=await Promise.all([i.e(507),i.e(618)]).then(i.bind(i,2618));let n=v.read("ipid");null!=n&&n===this.idPool||v.write("ipid",this.idPool),this.cognitoIdentityClient=new e({region:this.region});let o=v.read("cognitoid");if(null==o||n!==this.idPool){const e=new t({IdentityPoolId:this.idPool});o=(await this.cognitoIdentityClient.send(e)).IdentityId,v.write("cognitoid",o)}const s=new r({IdentityId:o});let a=await this.cognitoIdentityClient.send(s),c={accessKeyId:a.Credentials.AccessKeyId,expiration:a.Credentials.Expiration,identityId:o,secretAccessKey:a.Credentials.SecretKey,sessionToken:a.Credentials.SessionToken};return v.write("fhcred",JSON.stringify(c)),c}}const A=new class{configure(e){if(this.conf={},"aws"!==e.type||"firehose"!==e.service||"cognito"!==e.auth.type)throw new RuntimeException("cannot configure transmitter");this.conf.stream=e.data[e.dest],this.conf.idPool=e.auth.data[e.auth.key],this.conf.region=e.aws_region,this.cognitoCredentials=new I(this.conf.region,this.conf.idPool),this.retries=0,this.maxRetries=2,this._updateClient()}ready(){return!!this.client}async transmit(e){try{await this._transmit(e),this.retries=0}catch(r){if(!(this.retries<this.maxRetries&&(t=r,400==t.$response.statusCode||x.includes(t.name))))throw Error(r);this.retries++,await this._updateClient(),await this.transmit(e)}var t}async _transmit(e){const{PutRecordBatchCommand:t}=await Promise.all([i.e(507),i.e(603)]).then(i.bind(i,8603)),r=new t({DeliveryStreamName:this.conf.stream,Records:[{Data:Uint8Array.from(JSON.stringify(e),(e=>e.codePointAt(0)))}]});await this.client.send(r)}async _updateClient(){let e;e=this.retries===this.maxRetries?await this.cognitoCredentials.refresh():await this.cognitoCredentials.fetch();const{FirehoseClient:t}=await Promise.all([i.e(507),i.e(603)]).then(i.bind(i,8603));this.client=new t({credentials:e,region:this.conf.region})}},T=new class{constructor(e){this._semaphore=new C(1,e)}acquire(){return e=this,t=void 0,n=function*(){const[,e]=yield this._semaphore.acquire();return e},new((r=void 0)||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}));var e,t,r,n}runExclusive(e){return this._semaphore.runExclusive((()=>e()))}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.release()}cancel(){return this._semaphore.cancel()}};var k=0,P=[];let N;async function R(){!P.length||k>10||A.ready()&&T.runExclusive((async function(){var e=[...P];P=[];try{await A.transmit(e)}catch(t){let r=1e3+100*2**++k;clearInterval(N),O(r),P=e.concat(P)}}))}function O(e){N=setInterval(R,e)}function j(e){k<=10&&T.runExclusive((function(){P.push(e)}))}O(1e3);let M=!1;function L(e){e.optout||("SCOptout",document.cookie.match(new RegExp("(^| )SCOptout=([^;]+)")))?M=!0:function(e){for(const t of e)"aws"===t.type&&"firehose"===t.service&&A.configure(t)}(e.transmit)}function q(e,t){M||j(new b(b.type.ENGAGEMENT,e,t))}function D(e,t){M||j(new b(b.type.METADATA,e,t))}j(new b(b.type.PAGEVIEW,"start")),j(new b(b.type.METADATA,"page",{url:e,ref:t,top:r,chn:s,ua:n}))})(),o})()}));